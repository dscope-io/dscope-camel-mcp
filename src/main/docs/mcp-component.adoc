= MCP Component
:doctitle: MCP
:shortname: mcp
:artifactid: camel-mcp
:description: Camel component for the Model Context Protocol (MCP).
:since: 1.0
:supportlevel: Stable
:tabs-sync-option:
:component-header: Both producer and consumer are supported

*Since Camel {since}*

*{component-header}*

The MCP component provides integration with the https://modelcontextprotocol.io[Model Context Protocol] (MCP),
enabling Apache Camel routes to communicate with AI agents using the JSON-RPC 2.0 protocol.

== URI Format

[source]
----
mcp:uri[?options]
----

Where `uri` is the target MCP server endpoint (e.g., `http://localhost:8080/mcp`).

// component-configure options: START
// component-configure options: END

// component options: START
include::partial$component-configure-options.adoc[]
include::partial$component-endpoint-options.adoc[]
// component options: END

// endpoint options: START
// endpoint options: END

== Producer

The producer sends MCP JSON-RPC 2.0 requests to remote MCP servers or local Camel routes. Supported methods include:

* `initialize` – Initialize an MCP session
* `ping` – Health check ping
* `tools/list` – List available tools
* `tools/call` – Invoke a specific tool
* `resources/list` – List available resources
* `resources/read` – Read a specific resource

Producer dispatch is selected by endpoint URI structure:

* `mcp:camel:<camel-endpoint-uri>` – local in-process Camel route dispatch
* `mcp:http://...` / `mcp:https://...` – remote JSON transport dispatch

Use the URI prefix `camel:` after `mcp:` to target local in-process routes.

Per-message method override is supported via header `CamelMcpMethod`.

For Java callers, `io.dscope.camel.mcp.McpClient` provides helper methods such as
`pingResult(...)`, `toolsListResult(...)`, `pingResultJson(...)`, and `toolsListResultJson(...)`
to return MCP `result` payloads as either raw objects or `JsonNode`.

== Consumer

The consumer exposes an HTTP (or WebSocket) endpoint that acts as an MCP server,
receiving JSON-RPC 2.0 requests from MCP clients (e.g., AI agents).

The consumer sets the following exchange properties:

* `mcp.jsonrpc.method` – The JSON-RPC method name
* `mcp.jsonrpc.id` – The JSON-RPC request id
* `mcp.tool.name` – The tool name (for `tools/call` requests)

== Examples

=== Producer – Call a Tool

[source,yaml]
----
- from:
    uri: "timer:callTool?repeatCount=1"
    steps:
      - setBody:
          constant: '{"name":"echo","arguments":{"message":"hello"}}'
      - unmarshal:
          json: {}
      - to: "mcp:http://localhost:8080/mcp?method=tools/call"
      - log: "${body}"
----

=== Producer – Local Camel MCP Service

[source,java]
----
from("direct:start")
    .setBody(constant(Map.of("clientInfo", Map.of("name", "local-client", "version", "1.0.0"))))
    .to("mcp:camel:direct:localMcpService?method=initialize")
    .log("${body}");
----

=== Producer – Remote vs Local (YAML)

Remote MCP producer route:

[source,yaml]
----
- route:
        id: remote-mcp-client
        from:
            uri: "direct:remoteMcp"
            steps:
                - setBody:
                        constant:
                            clientInfo:
                                name: "camel-client"
                                version: "1.0.0"
                - to:
                        uri: "mcp:http://localhost:8080/mcp?method=initialize"
                - setBody:
                        simple: "${body[result]}"
----

Local MCP producer route + local service route:

[source,yaml]
----
- route:
        id: local-mcp-client
        from:
            uri: "direct:localMcpClient"
            steps:
                - setBody:
                        constant:
                            probe: true
                - to:
                        uri: "mcp:camel:direct:localMcpService?method=ping"
                - setBody:
                        simple: "${body[result]}"

- route:
        id: local-mcp-service
        from:
            uri: "direct:localMcpService"
            steps:
                - setBody:
                        simple: |
                            {
                                "jsonrpc": "2.0",
                                "id": "${body[id]}",
                                "result": {
                                    "method": "${body[method]}",
                                    "pong": true,
                                    "local": true
                                }
                            }
                - unmarshal:
                        json:
                            library: Jackson
----

=== Consumer – Expose an MCP Server

[source,java]
----
from("mcp:http://0.0.0.0:3000/mcp")
    .choice()
        .when(exchangeProperty("mcp.jsonrpc.method").isEqualTo("tools/list"))
            .setBody(constant("{\"tools\":[]}"))
        .when(exchangeProperty("mcp.jsonrpc.method").isEqualTo("tools/call"))
            .process(exchange -> { /* handle tool call */ })
    .end();
----
